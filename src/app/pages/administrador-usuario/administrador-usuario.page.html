<ion-header>
  <ion-toolbar>
    <ion-title>Administrar usuarios</ion-title>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="fondo-g">
   <div class="fondo-g">
    <ion-item>
      <ion-label position="floating">Nombre</ion-label>
      <ion-input [(ngModel)]="newUser.nombre" name="nombre" required minlength="2" #nombre="ngModel"></ion-input>
    </ion-item>
    <ion-note *ngIf="nombre.invalid && nombre.touched" color="danger">
      Nombre es requerido y debe tener al menos 2 caracteres.
    </ion-note>

    <ion-item>
      <ion-label position="floating">Apellido</ion-label>
      <ion-input [(ngModel)]="newUser.apellido" name="apellido" required minlength="2" #apellido="ngModel"></ion-input>
    </ion-item>
    <ion-note *ngIf="apellido.invalid && apellido.touched" color="danger">
      Apellido es requerido y debe tener al menos 2 caracteres.
    </ion-note>

    <ion-item>
      <ion-label position="floating">RUT</ion-label>
      <ion-input [(ngModel)]="newUser.rut" name="rut" required pattern="[0-9]{7,8}-[0-9Kk]" #rut="ngModel"></ion-input>
    </ion-item>
    <ion-note *ngIf="rut.invalid && rut.touched" color="danger">
      RUT debe tener un formato válido (Ejemplo: 12345678-9).
    </ion-note>

    <ion-item>
      <ion-label position="floating">Correo</ion-label>
      <ion-input [(ngModel)]="newUser.correo" name="correo" required email #correo="ngModel"></ion-input>
    </ion-item>
    <ion-note *ngIf="correo.invalid && correo.touched" color="danger">
      Correo debe tener un formato válido.
    </ion-note>

    <ion-item>
      <ion-label position="floating">Clave</ion-label>
      <ion-input [(ngModel)]="newUser.clave" name="clave" required minlength="8" type="password" #clave="ngModel"></ion-input>
    </ion-item>
    <ion-note *ngIf="clave.invalid && clave.touched" color="danger">
      La clave es requerida y debe tener al menos 8 caracteres.
    </ion-note>

    <ion-item>
      <ion-label position="floating">Teléfono</ion-label>
      <ion-input [(ngModel)]="newUser.telefono" name="telefono" required pattern="^[0-9]+$" #telefono="ngModel"></ion-input>
    </ion-item>
    <ion-note *ngIf="telefono.invalid && telefono.touched" color="danger">
      El teléfono debe contener solo números.
    </ion-note>
    
    <ion-item>
      <ion-label position="floating">Rol</ion-label>
      <ion-select [(ngModel)]="newUser.id_roll" name="id_roll" required #id_roll="ngModel">
        <ion-select-option value="1">Usuario</ion-select-option>
        <ion-select-option value="2">Repartidor</ion-select-option>
        <ion-select-option value="3">Admin</ion-select-option>
      </ion-select>
    </ion-item>
    <ion-note *ngIf="id_roll.invalid && id_roll.touched" color="danger">
      Selecciona un rol.
    </ion-note>

    <ion-item>
      <ion-label>Foto</ion-label>
      <ion-button (click)="takePicture()">Tomar Foto</ion-button>
    </ion-item>

    <div *ngIf="imagen">
      <img [src]="imagen" alt="Foto del usuario" style="width: 100px; height: 100px; margin-top: 10px; border-radius: 5px;">
    </div>

    <ion-button expand="full" (click)="addUsuario()">Guardar Usuario</ion-button>

    <ion-list>
      <ion-item *ngFor="let usuario of usuarios">
        <ion-thumbnail slot="start">
          
          <img [src]="usuario.foto || 'assets/perfil1.jpg'" alt="Foto de perfil">
        </ion-thumbnail>
        <ion-label>
          <h2>{{ usuario.nombre }} {{ usuario.apellido }}</h2>
          <p>{{ usuario.correo }}</p>
          <p>Teléfono: {{ usuario.telefono }}</p>
          <p>Rol: {{ usuario.id_roll === 1 ? 'Usuario' : usuario.id_roll === 2 ? 'Repartidor' : 'Admin' }}</p>
        </ion-label>

      
        <ion-button (click)="cargarDatosUsuario(usuario)" color="primary">Editar</ion-button>
        <ion-button (click)="eliminarUsuario(usuario.id_user!)" color="danger">Eliminar</ion-button>
      </ion-item>
    </ion-list>
  
  </div> 


  
</ion-content>
